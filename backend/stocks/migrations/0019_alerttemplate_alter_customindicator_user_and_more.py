# Generated by Django 4.2.11 on 2025-12-25 13:39

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('stocks', '0018_education_context_system'),
    ]

    operations = [
        migrations.CreateModel(
            name='AlertTemplate',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100)),
                ('description', models.TextField(blank=True)),
                ('conditions', models.JSONField(default=list, help_text='Array of alert conditions (AND logic)')),
                ('notify_sms', models.BooleanField(default=False)),
                ('notify_email', models.BooleanField(default=False)),
                ('notify_push', models.BooleanField(default=True)),
                ('is_active', models.BooleanField(default=True)),
                ('times_triggered', models.IntegerField(default=0)),
                ('last_triggered_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='alert_templates', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.AlterField(
            model_name='customindicator',
            name='user',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='old_custom_indicators', to=settings.AUTH_USER_MODEL),
        ),
        migrations.CreateModel(
            name='CopyTradingRelationship',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('status', models.CharField(choices=[('active', 'Active'), ('paused', 'Paused'), ('stopped', 'Stopped')], default='active', max_length=20)),
                ('allocation_amount', models.DecimalField(decimal_places=2, help_text='$ allocated to copy this strategy', max_digits=12)),
                ('position_size_multiplier', models.DecimalField(decimal_places=2, default=1.0, help_text='0.5 = half size, 2.0 = double size', max_digits=5)),
                ('max_daily_loss', models.DecimalField(blank=True, decimal_places=2, help_text='Stop copying if daily loss exceeds', max_digits=10, null=True)),
                ('stop_loss_pct', models.DecimalField(blank=True, decimal_places=2, help_text='Override strategy stop loss', max_digits=5, null=True)),
                ('is_paper_trading', models.BooleanField(default=True, help_text='Paper trade or live (future)')),
                ('total_profit_loss', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('trades_copied', models.IntegerField(default=0)),
                ('win_rate', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ('started_at', models.DateTimeField(auto_now_add=True)),
                ('paused_at', models.DateTimeField(blank=True, null=True)),
                ('stopped_at', models.DateTimeField(blank=True, null=True)),
                ('copier', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='copying', to=settings.AUTH_USER_MODEL)),
                ('strategy', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='copy_relationships', to='stocks.tradingstrategy')),
                ('trader', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='copiers', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-started_at'],
            },
        ),
        migrations.CreateModel(
            name='CopiedTrade',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('ticker', models.CharField(max_length=10)),
                ('action', models.CharField(help_text='buy, sell, short, cover', max_length=10)),
                ('quantity', models.IntegerField()),
                ('price', models.DecimalField(decimal_places=4, max_digits=12)),
                ('profit_loss', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('is_closed', models.BooleanField(default=False)),
                ('executed_at', models.DateTimeField(auto_now_add=True)),
                ('closed_at', models.DateTimeField(blank=True, null=True)),
                ('copy_relationship', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='trades', to='stocks.copytradingrelationship')),
                ('original_trade', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='copied_as', to='stocks.papertrade')),
            ],
            options={
                'ordering': ['-executed_at'],
            },
        ),
        migrations.CreateModel(
            name='UserCustomIndicator',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100)),
                ('description', models.TextField(blank=True)),
                ('indicator_type', models.CharField(choices=[('overlay', 'Overlay (on price chart)'), ('oscillator', 'Oscillator (separate panel)'), ('volume', 'Volume-based')], max_length=20)),
                ('formula', models.TextField(help_text='Pine Script or Python formula')),
                ('parameters', models.JSONField(default=dict, help_text='Configurable parameters with defaults')),
                ('visibility', models.CharField(choices=[('private', 'Private'), ('public', 'Public (marketplace)'), ('unlisted', 'Unlisted (link only)')], default='private', max_length=20)),
                ('usage_count', models.IntegerField(default=0, help_text='Times used by creator')),
                ('clone_count', models.IntegerField(default=0, help_text='Times cloned by others')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='custom_indicators', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
                'indexes': [models.Index(fields=['user', '-created_at'], name='stocks_user_user_id_92bff8_idx'), models.Index(fields=['visibility', '-clone_count'], name='stocks_user_visibil_bb01d1_idx')],
            },
        ),
        migrations.CreateModel(
            name='TriggeredAlert',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('ticker', models.CharField(max_length=10)),
                ('triggered_conditions', models.JSONField(default=list, help_text='Which conditions triggered')),
                ('market_data', models.JSONField(default=dict, help_text='Snapshot of market data at trigger time')),
                ('sms_sent', models.BooleanField(default=False)),
                ('email_sent', models.BooleanField(default=False)),
                ('push_sent', models.BooleanField(default=False)),
                ('is_acknowledged', models.BooleanField(default=False)),
                ('acknowledged_at', models.DateTimeField(blank=True, null=True)),
                ('triggered_at', models.DateTimeField(auto_now_add=True)),
                ('alert_template', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='triggers', to='stocks.alerttemplate')),
            ],
            options={
                'ordering': ['-triggered_at'],
                'indexes': [models.Index(fields=['alert_template', '-triggered_at'], name='stocks_trig_alert_t_98d110_idx'), models.Index(fields=['ticker', '-triggered_at'], name='stocks_trig_ticker_3c3dfc_idx'), models.Index(fields=['is_acknowledged', '-triggered_at'], name='stocks_trig_is_ackn_884549_idx')],
            },
        ),
        migrations.CreateModel(
            name='TradingJournal',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('title', models.CharField(max_length=200)),
                ('notes', models.TextField(help_text='Trade notes, reasoning, lessons learned')),
                ('emotion_before', models.CharField(blank=True, choices=[('confident', 'Confident'), ('anxious', 'Anxious'), ('fearful', 'Fearful'), ('greedy', 'Greedy'), ('neutral', 'Neutral'), ('disciplined', 'Disciplined'), ('impulsive', 'Impulsive')], help_text='Emotion before trade', max_length=20)),
                ('emotion_after', models.CharField(blank=True, choices=[('confident', 'Confident'), ('anxious', 'Anxious'), ('fearful', 'Fearful'), ('greedy', 'Greedy'), ('neutral', 'Neutral'), ('disciplined', 'Disciplined'), ('impulsive', 'Impulsive')], help_text='Emotion after trade', max_length=20)),
                ('followed_plan', models.BooleanField(blank=True, help_text='Did I follow my trading plan?', null=True)),
                ('mistakes_made', models.TextField(blank=True, help_text='What mistakes did I make?')),
                ('lessons_learned', models.TextField(blank=True, help_text='What did I learn?')),
                ('tags', models.JSONField(blank=True, default=list, help_text='Custom tags for categorization')),
                ('chart_screenshot_url', models.URLField(blank=True, help_text='Chart screenshot')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('trade', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='journal_entries', to='stocks.papertrade')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='journal_entries', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
                'indexes': [models.Index(fields=['user', '-created_at'], name='stocks_trad_user_id_941e5b_idx'), models.Index(fields=['emotion_before'], name='stocks_trad_emotion_e9c504_idx'), models.Index(fields=['followed_plan'], name='stocks_trad_followe_f1ffd3_idx')],
            },
        ),
        migrations.CreateModel(
            name='TradeExport',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('export_format', models.CharField(choices=[('csv', 'CSV'), ('pdf', 'PDF Report'), ('tax_prep', 'Tax Preparation Format'), ('json', 'JSON')], max_length=20)),
                ('date_from', models.DateField()),
                ('date_to', models.DateField()),
                ('include_paper_trades', models.BooleanField(default=True)),
                ('include_live_trades', models.BooleanField(default=False)),
                ('file_url', models.URLField(blank=True, help_text='S3 URL or file path')),
                ('file_size_bytes', models.IntegerField(default=0)),
                ('is_generated', models.BooleanField(default=False)),
                ('error_message', models.TextField(blank=True)),
                ('requested_at', models.DateTimeField(auto_now_add=True)),
                ('generated_at', models.DateTimeField(blank=True, null=True)),
                ('expires_at', models.DateTimeField(blank=True, help_text='Download link expiration', null=True)),
                ('strategy_filter', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='stocks.tradingstrategy')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='trade_exports', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-requested_at'],
                'indexes': [models.Index(fields=['user', '-requested_at'], name='stocks_trad_user_id_cfea68_idx'), models.Index(fields=['is_generated', '-requested_at'], name='stocks_trad_is_gene_4d26e6_idx')],
            },
        ),
        migrations.CreateModel(
            name='StrategyShare',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('share_type', models.CharField(choices=[('public', 'Public (marketplace)'), ('unlisted', 'Unlisted (link only)'), ('private_share', 'Private Share')], default='unlisted', max_length=20)),
                ('share_token', models.CharField(help_text='Unique token for sharing', max_length=32, unique=True)),
                ('view_count', models.IntegerField(default=0)),
                ('clone_count', models.IntegerField(default=0)),
                ('copy_count', models.IntegerField(default=0, help_text='Number of users copying this strategy')),
                ('allow_cloning', models.BooleanField(default=True)),
                ('allow_copying', models.BooleanField(default=False)),
                ('shared_at', models.DateTimeField(auto_now_add=True)),
                ('expires_at', models.DateTimeField(blank=True, help_text='Optional expiration', null=True)),
                ('shared_by', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='shared_strategies', to=settings.AUTH_USER_MODEL)),
                ('strategy', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='shares', to='stocks.tradingstrategy')),
            ],
            options={
                'ordering': ['-shared_at'],
                'indexes': [models.Index(fields=['share_token'], name='stocks_stra_share_t_2f8ae2_idx'), models.Index(fields=['share_type', '-view_count'], name='stocks_stra_share_t_4d93c7_idx')],
            },
        ),
        migrations.CreateModel(
            name='SocialUserProfile',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('display_name', models.CharField(blank=True, help_text='Public display name', max_length=100)),
                ('bio', models.TextField(blank=True, help_text='Short bio', max_length=500)),
                ('avatar_url', models.URLField(blank=True, help_text='Profile picture URL')),
                ('visibility', models.CharField(choices=[('private', 'Private (hidden)'), ('public', 'Public (discoverable)'), ('followers_only', 'Followers Only')], default='private', max_length=20)),
                ('followers_count', models.IntegerField(default=0)),
                ('following_count', models.IntegerField(default=0)),
                ('strategies_shared_count', models.IntegerField(default=0)),
                ('total_copiers', models.IntegerField(default=0, help_text='Total users copying this trader')),
                ('is_verified', models.BooleanField(default=False, help_text='Verified trader badge')),
                ('verification_date', models.DateTimeField(blank=True, null=True)),
                ('showcase_annual_return', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('showcase_sharpe_ratio', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ('showcase_win_rate', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ('allow_copy_trading', models.BooleanField(default=False, help_text='Allow others to copy trades')),
                ('allow_messages', models.BooleanField(default=True, help_text='Allow direct messages')),
                ('show_stats', models.BooleanField(default=True, help_text='Show performance stats on profile')),
                ('referral_code', models.CharField(blank=True, max_length=20, unique=True)),
                ('referral_count', models.IntegerField(default=0)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('referred_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='referrals', to='stocks.socialuserprofile')),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='social_profile', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
                'indexes': [models.Index(fields=['visibility', '-followers_count'], name='stocks_soci_visibil_d4677d_idx'), models.Index(fields=['is_verified', '-followers_count'], name='stocks_soci_is_veri_4f5ade_idx'), models.Index(fields=['referral_code'], name='stocks_soci_referra_285347_idx')],
            },
        ),
        migrations.CreateModel(
            name='SocialFollow',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('followed_at', models.DateTimeField(auto_now_add=True)),
                ('notifications_enabled', models.BooleanField(default=True, help_text='Get notified of new strategies')),
                ('follower', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='social_following', to=settings.AUTH_USER_MODEL)),
                ('following', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='social_followers', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-followed_at'],
                'indexes': [models.Index(fields=['follower', '-followed_at'], name='stocks_soci_followe_9d9859_idx'), models.Index(fields=['following', '-followed_at'], name='stocks_soci_followi_3f6532_idx')],
                'unique_together': {('follower', 'following')},
            },
        ),
        migrations.CreateModel(
            name='ReferralReward',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('reward_type', models.CharField(choices=[('signup', 'Signup Bonus'), ('first_trade', 'First Trade Bonus'), ('subscription', 'Subscription Commission')], max_length=20)),
                ('amount', models.DecimalField(decimal_places=2, help_text='Reward amount in $', max_digits=10)),
                ('is_paid', models.BooleanField(default=False)),
                ('paid_at', models.DateTimeField(blank=True, null=True)),
                ('earned_at', models.DateTimeField(auto_now_add=True)),
                ('referred_user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='referral_source', to=settings.AUTH_USER_MODEL)),
                ('referrer', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='referral_rewards', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-earned_at'],
                'indexes': [models.Index(fields=['referrer', '-earned_at'], name='stocks_refe_referre_d63a4a_idx'), models.Index(fields=['is_paid', '-earned_at'], name='stocks_refe_is_paid_65c170_idx')],
            },
        ),
        migrations.CreateModel(
            name='PerformanceReview',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('review_period', models.CharField(choices=[('weekly', 'Weekly'), ('monthly', 'Monthly'), ('quarterly', 'Quarterly'), ('yearly', 'Yearly')], default='monthly', max_length=20)),
                ('period_start', models.DateField()),
                ('period_end', models.DateField()),
                ('total_trades', models.IntegerField(default=0)),
                ('winning_trades', models.IntegerField(default=0)),
                ('losing_trades', models.IntegerField(default=0)),
                ('win_rate', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ('total_profit_loss', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('avg_win', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('avg_loss', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('profit_factor', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ('max_drawdown', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ('sharpe_ratio', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ('most_common_emotion', models.CharField(blank=True, max_length=20)),
                ('plan_adherence_rate', models.DecimalField(blank=True, decimal_places=2, help_text='% of trades following plan', max_digits=5, null=True)),
                ('summary', models.TextField(blank=True, help_text='AI-generated summary of performance')),
                ('recommendations', models.TextField(blank=True, help_text='AI-generated recommendations')),
                ('is_generated', models.BooleanField(default=False)),
                ('is_viewed', models.BooleanField(default=False)),
                ('viewed_at', models.DateTimeField(blank=True, null=True)),
                ('generated_at', models.DateTimeField(auto_now_add=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='performance_reviews', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-period_end'],
                'indexes': [models.Index(fields=['user', '-period_end'], name='stocks_perf_user_id_95727e_idx'), models.Index(fields=['is_generated', '-generated_at'], name='stocks_perf_is_gene_3b2501_idx')],
                'unique_together': {('user', 'review_period', 'period_start', 'period_end')},
            },
        ),
        migrations.AddIndex(
            model_name='copytradingrelationship',
            index=models.Index(fields=['copier', 'status'], name='stocks_copy_copier__5f85e0_idx'),
        ),
        migrations.AddIndex(
            model_name='copytradingrelationship',
            index=models.Index(fields=['trader', 'status'], name='stocks_copy_trader__a8d5bf_idx'),
        ),
        migrations.AddIndex(
            model_name='copytradingrelationship',
            index=models.Index(fields=['strategy', 'status'], name='stocks_copy_strateg_3faed3_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='copytradingrelationship',
            unique_together={('copier', 'strategy')},
        ),
        migrations.AddIndex(
            model_name='copiedtrade',
            index=models.Index(fields=['copy_relationship', '-executed_at'], name='stocks_copi_copy_re_722cc7_idx'),
        ),
        migrations.AddIndex(
            model_name='copiedtrade',
            index=models.Index(fields=['ticker', '-executed_at'], name='stocks_copi_ticker_83461e_idx'),
        ),
        migrations.AddIndex(
            model_name='alerttemplate',
            index=models.Index(fields=['user', 'is_active'], name='stocks_aler_user_id_2f0e5d_idx'),
        ),
        migrations.AddIndex(
            model_name='alerttemplate',
            index=models.Index(fields=['is_active', '-created_at'], name='stocks_aler_is_acti_151f0f_idx'),
        ),
    ]
