<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
        <link rel="apple-touch-icon" sizes="180x180" href="%PUBLIC_URL%/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="%PUBLIC_URL%/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="%PUBLIC_URL%/favicon-16x16.png">
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="theme-color" content="#1d4ed8" />
        <meta name="robots" content="index,follow" />
        
        <!-- Security Headers -->
        <meta http-equiv="X-Content-Type-Options" content="nosniff">
        <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
        <meta http-equiv="X-XSS-Protection" content="1; mode=block">
        <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
        
        <!-- Open Graph / Social Media -->
        <meta property="og:title" content="Stock Scanner - Professional Trading Platform" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="%REACT_APP_WEBSITE_URL%" />
        <meta property="og:description" content="Professional stock market scanner, portfolio and research platform for modern traders." />
        <meta property="og:image" content="%PUBLIC_URL%/og-image.png" />
        
        <!-- Twitter Card -->
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title" content="Stock Scanner - Professional Trading Platform">
        <meta name="twitter:description" content="Professional stock market scanner and trading platform">
        <meta name="twitter:image" content="%PUBLIC_URL%/og-image.png">
        
        <link rel="sitemap" type="application/xml" href="/sitemap.xml" />
        <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
        
        <meta name="description" content="Professional stock market scanner and trading platform - Real-time data, portfolio tracking, and advanced analytics" />
        
        <title>Stock Scanner - Professional Trading Platform</title>
        
        <!-- Preconnect to API -->
        <link rel="preconnect" href="https://api.retailtradescanner.com">
        <link rel="dns-prefetch" href="https://api.retailtradescanner.com">
        
        <!-- Preload critical fonts if any -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        
        <style>
            /* Critical CSS for initial render */
            body {
                margin: 0;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                    sans-serif;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }
            
            #root {
                min-height: 100vh;
            }
            
            /* Loading spinner for initial load */
            .app-loader {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                display: flex;
                align-items: center;
                justify-content: center;
                background: white;
                z-index: 9999;
            }
            
            .app-loader-spinner {
                width: 50px;
                height: 50px;
                border: 3px solid #f3f4f6;
                border-top: 3px solid #2563eb;
                border-radius: 50%;
                animation: spin 1s linear infinite;
            }
            
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
            
            /* Hide loader when app is ready */
            .app-ready .app-loader {
                display: none;
            }
            
            /* Noscript message */
            .noscript-message {
                padding: 20px;
                background: #fee;
                text-align: center;
                font-size: 18px;
                color: #c00;
            }
        </style>
        
        <!-- Environment Variables Check -->
        <script>
            // Store API configuration
            window.__APP_CONFIG__ = {
                API_URL: '%REACT_APP_API_URL%' || 'https://api.retailtradescanner.com',
                ENV: '%REACT_APP_ENV%' || 'production'
            };
            
            // Check if API is reachable on load
            if (window.__APP_CONFIG__.ENV === 'production') {
                fetch(window.__APP_CONFIG__.API_URL + '/health/')
                    .then(function(response) {
                        if (!response.ok) {
                            console.warn('API health check failed');
                        }
                    })
                    .catch(function(error) {
                        console.error('API is unreachable:', error);
                    });
            }
            
            // Performance monitoring
            window.addEventListener('load', function() {
                if (window.performance && window.performance.timing) {
                    var timing = window.performance.timing;
                    var loadTime = timing.loadEventEnd - timing.navigationStart;
                    console.log('Page load time:', loadTime + 'ms');
                    
                    // Send to analytics if needed
                    if (window.gtag) {
                        window.gtag('event', 'timing_complete', {
                            'name': 'load',
                            'value': loadTime,
                            'event_category': 'Performance'
                        });
                    }
                }
            });
            
            // Remove loader when React app is mounted
            window.addEventListener('DOMContentLoaded', function() {
                setTimeout(function() {
                    document.body.classList.add('app-ready');
                }, 100);
            });
        </script>
        
        <!-- Google Analytics (if needed) -->
        <!-- 
        <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'GA_MEASUREMENT_ID');
        </script>
        -->
    </head>
    <body>
        <!-- Loading indicator -->
        <div class="app-loader" id="app-loader">
            <div class="app-loader-spinner"></div>
        </div>
        
        <noscript>
            <div class="noscript-message">
                <h1>JavaScript Required</h1>
                <p>You need to enable JavaScript to run this application.</p>
                <p>Please enable JavaScript in your browser settings and refresh the page.</p>
            </div>
        </noscript>
        
        <div id="root"></div>
        
        <!-- Error fallback -->
        <script>
            window.addEventListener('error', function(event) {
                if (event.error && event.error.stack && event.error.stack.includes('ChunkLoadError')) {
                    // Handle chunk load errors (usually from code splitting)
                    console.error('Chunk load error, reloading page...');
                    window.location.reload();
                }
            });
            
            // Handle unhandled promise rejections
            window.addEventListener('unhandledrejection', function(event) {
                console.error('Unhandled promise rejection:', event.reason);
                
                // Send to error tracking if in production
                if (window.__APP_CONFIG__ && window.__APP_CONFIG__.ENV === 'production') {
                    // Log to backend or error service
                    fetch(window.__APP_CONFIG__.API_URL + '/api/client-error/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            error: event.reason.toString(),
                            url: window.location.href,
                            timestamp: new Date().toISOString()
                        })
                    }).catch(function() {
                        // Ignore logging errors
                    });
                }
            });
        </script>
    </body>
</html>