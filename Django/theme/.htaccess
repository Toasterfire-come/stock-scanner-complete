# .htaccess for Stock Scanner Pro WordPress Theme
# Optimized for performance, security, and SEO

# BEGIN WordPress Security
<IfModule mod_rewrite.c>
RewriteEngine On

# Block access to sensitive files
<Files "wp-config.php">
Require all denied
</Files>

<Files "readme.html">
Require all denied
</Files>

<Files "license.txt">
Require all denied
</Files>

<Files ".htaccess">
Require all denied
</Files>

<Files "debug.log">
Require all denied
</Files>

# Block PHP execution in uploads directory
RewriteRule ^wp\-content/uploads/.*\.php$ - [F,L]

# Block access to wp-includes for non-essential files
RewriteRule ^wp-includes/.*\.php$ - [F,L]
RewriteRule !^wp-includes/$ ^wp-includes/ - [F,L]

# Block XML-RPC attacks
<Files "xmlrpc.php">
Require all denied
</Files>

</IfModule>
# END WordPress Security

# BEGIN Performance Optimization
<IfModule mod_expires.c>
ExpiresActive On
ExpiresByType text/css "access plus 1 year"
ExpiresByType application/javascript "access plus 1 year"
ExpiresByType application/x-javascript "access plus 1 year"
ExpiresByType text/javascript "access plus 1 year"
ExpiresByType image/png "access plus 1 year"
ExpiresByType image/jpg "access plus 1 year"
ExpiresByType image/jpeg "access plus 1 year"
ExpiresByType image/gif "access plus 1 year"
ExpiresByType image/svg+xml "access plus 1 year"
ExpiresByType image/webp "access plus 1 year"
ExpiresByType image/avif "access plus 1 year"
ExpiresByType font/woff "access plus 1 year"
ExpiresByType font/woff2 "access plus 1 year"
ExpiresByType application/font-woff "access plus 1 year"
ExpiresByType application/font-woff2 "access plus 1 year"
ExpiresByType application/vnd.ms-fontobject "access plus 1 year"
ExpiresByType application/x-font-ttf "access plus 1 year"
ExpiresByType text/html "access plus 1 hour"
ExpiresByType application/json "access plus 1 hour"
ExpiresByType application/xml "access plus 1 hour"
ExpiresByType text/xml "access plus 1 hour"
</IfModule>

# Cache-Control headers
<IfModule mod_headers.c>
<FilesMatch "\.(css|js|png|jpg|jpeg|gif|svg|webp|avif|woff|woff2|eot|ttf)$">
Header set Cache-Control "public, max-age=31536000"
</FilesMatch>

<FilesMatch "\.(html|htm)$">
Header set Cache-Control "public, max-age=3600"
</FilesMatch>

# Security headers
Header always set X-Content-Type-Options nosniff
Header always set X-Frame-Options SAMEORIGIN
Header always set X-XSS-Protection "1; mode=block"
Header always set Referrer-Policy "strict-origin-when-cross-origin"
Header always set Permissions-Policy "geolocation=(), microphone=(), camera=()"

# CSP for Stock Scanner Pro theme
Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://www.google-analytics.com https://www.googletagmanager.com https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https: http:; connect-src 'self' https://api.stockscanner.com https://www.google-analytics.com; frame-src 'self' https://www.youtube.com; object-src 'none'; base-uri 'self';"

# Remove server signature
Header unset Server
Header unset X-Powered-By
ServerTokens Prod
</IfModule>

# Gzip compression
<IfModule mod_deflate.c>
AddOutputFilterByType DEFLATE text/plain
AddOutputFilterByType DEFLATE text/html
AddOutputFilterByType DEFLATE text/xml
AddOutputFilterByType DEFLATE text/css
AddOutputFilterByType DEFLATE application/xml
AddOutputFilterByType DEFLATE application/xhtml+xml
AddOutputFilterByType DEFLATE application/rss+xml
AddOutputFilterByType DEFLATE application/javascript
AddOutputFilterByType DEFLATE application/x-javascript
AddOutputFilterByType DEFLATE application/json
AddOutputFilterByType DEFLATE image/svg+xml
</IfModule>

# Enable KeepAlive
<IfModule mod_headers.c>
Header set Connection keep-alive
</IfModule>
# END Performance Optimization

# BEGIN WordPress Rewrite Rules
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /
RewriteRule ^index\.php$ - [L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.php [L]

# Force HTTPS (uncomment if SSL is configured)
# RewriteCond %{HTTPS} off
# RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Remove www (or add www based on preference)
# Remove www:
# RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
# RewriteRule ^(.*)$ https://%1/$1 [R=301,L]

# Add www:
# RewriteCond %{HTTP_HOST} !^www\. [NC]
# RewriteRule ^(.*)$ https://www.%{HTTP_HOST}/$1 [R=301,L]

# Trailing slash redirect
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{THE_REQUEST} \s/+([^?]*?)(?:\?[^\s]*?)?\s [NC]
RewriteRule ^ /%1/ [R=301,L]

</IfModule>
# END WordPress Rewrite Rules

# BEGIN File type optimization
<IfModule mod_mime.c>
# Web fonts
AddType application/font-woff woff
AddType application/font-woff2 woff2
AddType application/vnd.ms-fontobject eot
AddType application/x-font-ttf ttf
AddType font/opentype otf
AddType image/svg+xml svg

# Modern image formats
AddType image/webp webp
AddType image/avif avif

# JSON
AddType application/json json
AddType application/ld+json jsonld

# Security
AddType text/plain txt log
</IfModule>
# END File type optimization

# BEGIN Hotlink Protection (optional - uncomment and modify domain)
# <IfModule mod_rewrite.c>
# RewriteCond %{HTTP_REFERER} !^$
# RewriteCond %{HTTP_REFERER} !^https?://(www\.)?yourdomain\.com [NC]
# RewriteRule \.(jpg|jpeg|png|gif|webp|svg)$ - [F]
# </IfModule>
# END Hotlink Protection

# BEGIN Error Pages
ErrorDocument 400 /error-pages/400.html
ErrorDocument 401 /error-pages/401.html
ErrorDocument 403 /error-pages/403.html
ErrorDocument 404 /error-pages/404.html
ErrorDocument 500 /error-pages/500.html
ErrorDocument 502 /error-pages/502.html
ErrorDocument 503 /error-pages/503.html
# END Error Pages

# Disable directory browsing
Options -Indexes

# Prevent access to WordPress configuration files
<Files wp-config.php>
order allow,deny
deny from all
</Files>

# Limit file upload size (adjust as needed)
php_value upload_max_filesize 64M
php_value post_max_size 64M
php_value max_execution_time 300
php_value max_input_vars 3000

# Note: Remember to:
# 1. Replace "yourdomain.com" with your actual domain
# 2. Configure SSL/HTTPS redirects based on your setup
# 3. Adjust file upload limits based on your needs
# 4. Test all rules after implementation