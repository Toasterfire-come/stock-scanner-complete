{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}Stock Scanner{% endblock %}</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="{% static 'css/theme.css' %}">
  {% block head %}{% endblock %}
</head>
<body>
  <nav class="navbar">
    <div class="navbar-inner container-wide">
      <div class="brand">
        <span class="brand-badge">ðŸ“ˆ</span>
        <span class="brand-name">Retail Trade Scanner</span>
      </div>
      <div class="nav-links" role="navigation" aria-label="Primary">
        <a href="/">Home</a>
        <a href="/screeners/">Screeners</a>
        <a href="/api/stocks/" target="_blank">API</a>
        <a href="/admin/" target="_blank">Admin</a>
        <a href="/pricing/" class="btn primary" style="margin-left:8px;">Try for free</a>
      </div>
    </div>
  </nav>

  <main class="container-wide" style="padding-top: 20px;">
    {% block content %}{% endblock %}
  </main>

  <footer class="footer container-wide" role="contentinfo">
    <div>Â© {{ now|default:"" }} Retail Trade Scanner â€¢ High-quality market insights</div>
    <form id="newsletter" class="grid" style="margin-top:12px; max-width: 560px; margin-left:auto; margin-right:auto;">
      <input class="form-control" type="email" id="newsletterEmail" placeholder="Get daily top gainers â€” your email" required />
      <button class="btn primary" type="submit">Subscribe</button>
      <div id="newsletterResult" class="muted"></div>
    </form>
  </footer>

  <!-- Mobile sticky CTA bar -->
  <div class="sticky-cta">
    <a class="btn primary" href="/pricing/">Try for free</a>
    <a class="btn" href="/login/">Log in</a>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Reusable Create Alert Modal -->
  <div class="modal fade" id="createAlertModal" tabindex="-1" aria-labelledby="createAlertLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content" style="background: var(--panel-2); color: var(--text); border:1px solid var(--border);">
        <div class="modal-header" style="border-bottom:1px solid var(--border);">
          <h5 class="modal-title" id="createAlertLabel">Create Price Alert</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="createAlertForm" class="grid">
            <div>
              <label class="muted">Ticker</label>
              <input class="form-control" name="ticker" id="alertTicker" required />
            </div>
            <div>
              <label class="muted">Target price</label>
              <input class="form-control" name="price" id="alertPrice" type="number" step="0.01" required />
            </div>
            <div>
              <label class="muted">Condition</label>
              <select class="form-select" id="alertCondition">
                <option value="above">Above</option>
                <option value="below">Below</option>
              </select>
            </div>
            <div>
              <label class="muted">Email</label>
              <input class="form-control" name="email" id="alertEmail" type="email" required />
            </div>
          </form>
          <div id="alertResult" class="muted" style="margin-top:8px;"></div>
        </div>
        <div class="modal-footer" style="border-top:1px solid var(--border);">
          <button type="button" class="btn" data-bs-dismiss="modal">Cancel</button>
          <button type="button" id="submitAlert" class="btn primary">Create alert</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Lightweight analytics stub
    window.analytics = { track: (name, props) => { try { console.log('[analytics]', name, props||{}); } catch(_){} } };
    // Create Alert modal logic
    (function(){
      const modalEl = document.getElementById('createAlertModal');
      const modal = modalEl ? new bootstrap.Modal(modalEl) : null;
      function openCreateAlert(opts){
        if (!modal) return;
        document.getElementById('alertTicker').value = opts?.ticker || '';
        if (opts?.price) document.getElementById('alertPrice').value = opts.price;
        document.getElementById('alertCondition').value = opts?.condition || 'above';
        document.getElementById('alertEmail').value = opts?.email || '';
        document.getElementById('alertResult').textContent = '';
        modal.show();
      }
      window.openCreateAlert = openCreateAlert;
      document.getElementById('submitAlert')?.addEventListener('click', async () => {
        const ticker = document.getElementById('alertTicker').value.trim();
        const price = parseFloat(document.getElementById('alertPrice').value);
        const condition = document.getElementById('alertCondition').value;
        const email = document.getElementById('alertEmail').value.trim();
        if (!ticker || !price || !email) return;
        analytics.track('create_alert_submit', { ticker });
        const resp = await fetch('/api/alerts/create/', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ ticker, target_price: price, condition, email }) });
        const j = await resp.json();
        document.getElementById('alertResult').textContent = j.message || j.error || 'Saved';
        if (j.alert_id) setTimeout(()=>modal.hide(), 800);
      });
    })();
  </script>
  <script>
    // Newsletter capture using WordPress subscribe API we exposed
    (function(){
      const form = document.getElementById('newsletter');
      if (!form) return;
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('newsletterEmail').value.trim();
        if (!email) return;
        analytics.track('newsletter_subscribe_attempt');
        const resp = await fetch('/api/wordpress/subscribe/', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ email, category: 'top-gainers' }) });
        const j = await resp.json();
        document.getElementById('newsletterResult').textContent = j.message ? 'Subscribed!' : (j.error || 'Thanks!');
      });
    })();
  </script>
  {% block scripts %}{% endblock %}
</body>
</html>
